function generatecommentbox(e,t=!1){var o=$("<div />",{class:"d-flex justify-content-space"}),a=$("<p />",{class:"m-0 comment-action mr-auto"});t||a.append($("<a />",{href:"#",class:"show-hide-reply","data-id":e.voice_id,"data-comment_id":e.comment_id,"data-reply_id":e.comment_reply_id}).append($("<small />",{class:""}).html("Reply"))),uid==e.user_id&&(t||a.append($("<span />").html("&nbsp;&nbsp;&#9679;&nbsp;&nbsp;")),a.append($("<a />",{href:"#",class:t?"edit-comment-reply":"edit-comment","data-id":e.voice_id,"data-comment_id":e.comment_id,"data-reply_id":e.comment_reply_id}).append($("<small />",{class:""}).html("Edit"))).append($("<span />").html("&nbsp;&nbsp;&#9679;&nbsp;&nbsp;")).append($("<a />",{href:"#",class:t?"reply-delete":"comment-delete","data-id":e.voice_id,"data-comment_id":e.comment_id,"data-reply_id":e.comment_reply_id}).append($("<small />").html("Delete"))));var i=$("<p />",{class:"m-0 comment-action ml-auto"}).append($("<small />",{class:"text-black-50"}).html(e.total_replies+(1==e.total_replies?" Reply":" Replies")));o.append(a),t||o.append(i);var l=$("<div />",{class:t?"row reply_num_"+e.comment_reply_id:"row comment mb-3 comment_num_"+e.comment_id}),n=$("<div />",{class:t?"col-10 col-md-11 pt-0 comment-reply-text-holder":"col-10 col-md-11 pt-0 comment-text-holder"}),s=$("<div />",{class:" col-md-1 col-2 p-2  d-flex"}).append($("<div />",{class:"userimg position-relative","data-line":e.alias[0]}).css("background-color",getrandomcolor())),c=$("<h6 />",{class:"font-weight-bold mb-2 pt-2 text-capitalize"}).html(e.alias),d=$("<p />",{class:t?"maincolor mb-2 font-weight-300":"p-comment maincolor mb-2 font-weight-300"}).html(t?e.comment_reply:e.comment),r=makereplybox(e,t),m=$("<div />",{class:"col-10 col-md-11 offset-md-1 offset-2 mb-3 d-none reply-container_"+e.comment_id}).append($("<div />",{class:"row"}).append(makereplybox(e,!1,!0))).append($("<div />",{class:"comment-reply-list"}));return n.append(c).append(d).append(r).append(o),l.append(s).append(n),t||l.append(m),l}function makereplybox(e,t=!1,o=!1){var a="edit_comment_box_holder d-none input-group",i="post-edit-comment",l="cust-textarea edit-comment-text form-control";t&&(a="edit_comment_reply_box_holder d-none input-group",i="post-edit-comment-reply",l="cust-textarea edit-comment-reply-text form-control"),o&&(a="col pt-2 comment-reply-box-holder input-group",i="post-comment-reply",l="cust-textarea comment-reply-text form-control");var n=$("<div />",{class:a});return n.append($("<textarea />",{class:l,placeholder:"Write Reply"})).append($("<div />",{class:"input-group-append"}).append($("<a />",{href:"#",class:i,"data-id":e.voice_id,"data-comment_id":e.comment_id,"data-reply_id":e.comment_reply_id}).append($("<span />",{class:"d-block sendicon"}).html('<svg viewBox="0 0 20 20"><path fill="rgb(255, 255, 255)" d="M0.000,18.000 L22.000,9.000 L0.000,0.000 L0.000,7.000 L15.714,9.000 L0.000,11.000 L0.000,18.000 Z"/></svg>')))).append($("<p />",{class:o?"error comment-error mb-0 ml-1 text-danger":"error edit-comment-reply-error mb-0 ml-1 text-danger"})),n}function convert_numbers(e){if(isNaN(e))return 0;var t=e,o="";return e>=1e3&&(4!=(o=(""+e).length)&&5!=o&&6!=o||(t=parseFloat((e/1e3).toFixed(1))+"K"),7==o&&(t=parseFloat((e/1e6).toFixed(1))+"M")),t}function getrandomcolor(){var e=["#1abc9c","#2ecc71","#3498db","#9b59b6","#e67e22","#e74c3c","#d35400","#f1c40f","#2c3e50","#16a085","#34495e","#2980b9","#12CBC4","#EE5A24","#009432","#ED4C67","#FFC312","#5758BB"];return e[Math.floor(Math.random()*e.length)]}function create_slug(e){var t="";return t=e.replace(/[~`!@#$%^&*()_=+{}|\/;'<>?,]/g,""),t=t.split(" ").join("-")}function load_voices(e){$.ajax({url:base_url+"YourVoice/load_voices",method:"POST",data:{offset:e,notin:0}}).done(function(t){var o=(t=JSON.parse(t)).data,a=($("<div />",{class:"w-100"}),$("<div />",{class:"adimg col-12 mt-3"}).append($("<a />",{class:"d-block",href:"http://www.loudst.com/",target:"_blank"}).append($("<img />",{src:base_url+"images/special/samsung.jpg?v="+(new Date).getTime(),class:"img-fluid "})))),i=$(".blog-list-section .blog-list");if(o.length>0){if(e<1&&1==$(".blog-list-page").length){var l=o.splice(0,1)[0];$(".most-popular").append($("<div >",{class:"row"}).append(getblock(l,!0)))}for(var n in o)i.append(getblock(o[n],!1));$(".blog-detail-trending .blog-list").width($(".blog-detail-trending .blog-list-item").length*$(".blog-detail-trending .blog-list-item").outerWidth()+100),"1"==t.is_available?$(".load-more-voice-list").closest(".load-btn-holder").removeClass("hide"):$(".load-more-voice-list").closest(".load-btn-holder").addClass("hide")}$(".blog-list .adimg").remove(),$(".blog-list .blog-list-item").each(function(e,t){(e%9==0||3==e)&&e>0&&$(".blog-list-page").length>0&&a.clone().insertBefore(t)}),flag&&($(".load-more-voice-list").trigger("click"),flag=!flag)})}function getblock(e,t=!1){var o=convert_numbers(e.total_likes),a=convert_numbers(e.total_views),i=convert_numbers(e.total_comments),l=create_slug(e.title),n=$("<div />",{class:"overlay"}),s=$("<div />",{class:t?"col-12 top-blog blog-list-item my-1":"col-md-4 blog-list-item"}),c=$("<a/>",{href:base_url+"YourVoice/blog_detail/"+e.id+"/"+l+"?t="+timestamp,class:"d-block pb-3",style:t?"background: url('"+e.image+"') no-repeat center center;":""}),d=$("<div />",{class:"voiceimg p-5",style:"background: url('"+e.image+"')  no-repeat center center;"}),r=$("<small />",{class:"likes"}).html(o+" Likes &nbsp;&nbsp;&#9679;&nbsp;&nbsp; "+a+" Views &nbsp;&nbsp;&#9679;&nbsp;&nbsp; "+i+" Comments"),m=$("<small />",{class:"category"}).html(e.category),p=$("<h6 />").html(e.title),_=$("<div />",{class:"d-flex flex-column h-100 w-100 justify-content-end"});return t?c.append(n).append(_.append(m).append(p).append(r)):c.append(d).append(m).append(p).append(r),s.append(c),s}var base_url=$("body").attr("data-base_url"),date=new Date,timestamp=date.getTime(),flag=!0,uid=$("body").attr("data-uid"),voiceid=$("body").attr("data-detailid");$(function(){$(document).ajaxStart(function(){$("#loading").show()}),$(document).ajaxStop(function(){$("#loading").hide()}),$("a.head-login").attr("href",base_url+"Login?section=voice");var e=7,t=0;load_voices(t);if(load_articles(0),""!=voiceid){load_latest_voices(0),$("a.head-login").attr("href",base_url+"Login?section=voicedetail&vid="+voiceid)}if($(".blog-list-page .load-more-voice-list").on("click",function(o){load_voices(t+=e=0==t?7:6)}),$(".btn_create_voice").on("click",function(e){e.preventDefault();var t=$("body").attr("data-uid"),o=$("body").attr("data-silver_points"),a="";0==t?window.location.assign(base_url+"Login?section=voice"):o<25?(a='<div><img src="'+base_url+'images/banners/coin_f.png"><span>'+o+"</span></div><p>You can't raise any Poll.</p><p>You must have 25 silver points to raise a Voice.</p>",$("#silverPointsCheck .modal-title").html("Your Balance Points"),$("#silverPointsCheck .modal-body").html(a),$("#silverPointsCheck button#create_voice_yes").hide(),$("#silverPointsCheck button#create_voice_no").hide(),$("#silverPointsCheck button#create_voice_ok").show(),$("#silverPointsCheck").modal("show")):(a='<div><img src="'+base_url+'images/banners/coin_f.png"><span>'+o+"</span></div><p>Redeem 25 Points to raise a voice.</p>",$("#silverPointsCheck .modal-title").html("Your Balance Points"),$("#silverPointsCheck .modal-body").html(a),$("#silverPointsCheck button#create_voice_yes").show(),$("#silverPointsCheck button#create_voice_no").show(),$("#silverPointsCheck button#create_voice_ok").hide(),$("#silverPointsCheck").modal("show"))}),$("#silverPointsCheck button#create_voice_yes").on("click",function(){window.location.assign(base_url+"YourVoice/raise_voice")}),options.toast)return Materialize.Toast.removeAll(),Materialize.toast(options.toast,4e3),!1;$(".description-container p").each(function(){var e=$(this);0==e.html().replace(/\s|&nbsp;/g,"").length&&e.remove()}),$(".comment").each(function(){$(this).find(".userimg").css("background-color",getrandomcolor())}),$(".post-comment").on("click",function(e){if(e.preventDefault(),0==uid)return window.location.assign(base_url+"Login?section=voicedetail&vid="+voiceid),!1;var t=$(this),o=t.closest(".comment-box-holder").find("textarea.comment-text").val().trim(),a=t.attr("data-id"),i=$(document.createDocumentFragment()),l=parseInt($("#comentbox .total-comments-count").html());if(""==o)return t.closest(".row").find(".comment-error").html("Please enter comment"),!1;t.addClass("disabled"),$.ajax({url:base_url+"YourVoice/comment_on_voice",method:"POST",data:{voice_id:a,comment:o}}).done(function(e){if((e=JSON.parse(e)).status){t.removeClass("disabled"),t.closest(".comment-box-holder").find("textarea.comment-text").val("");var n=[];n.comment_id=e.data.comment_id,n.alias=$("body").attr("data-alias")?$("body").attr("data-alias"):"You",n.comment=o,n.voice_id=a,n.user_id=uid,n.total_replies=0,t.removeClass("disabled"),t.closest(".comment-reply-box-holder").find("textarea.comment-reply-text").val(""),i=generatecommentbox(n),$("#comentbox .total-comments-count").html(l+1);var s=parseInt(t.closest(".comment_container").find(".row .view-more-comments").attr("data-offset"))+1;t.closest(".comment_container").find(".comments-list").prepend(i),t.closest(".comment_container").find(".row .view-more-comments").attr("data-offset",s)}else t.removeClass("disabled")})}),$(document).on("click",".edit-comment",function(e){e.preventDefault();var t=$(this).attr("data-comment_id");$(this).closest(".comment_num_"+t).find(".edit_comment_box_holder").toggleClass("d-none").find("textarea").val($(this).closest(".comment_num_"+t).find("p.p-comment").text()),$(this).closest(".comment_num_"+t).find("p.p-comment").toggleClass("d-none")}),$(document).on("click",".post-edit-comment",function(e){e.preventDefault();var t=$(this),o=t.attr("data-id"),a=t.attr("data-comment_id"),i=t.closest(".edit_comment_box_holder").find("textarea.edit-comment-text").val().trim();if(""==i)return t.closest(".edit_comment_box_holder").find(".edit-comment-error").html("Please enter comment"),!1;t.addClass("disabled"),$.ajax({url:base_url+"YourVoice/update_comment_on_voice",method:"POST",data:{voice_id:o,comment_id:a,comment:i}}).done(function(e){(e=JSON.parse(e)).status?(t.removeClass("disabled"),t.closest(".comment_num_"+a).find(".edit_comment_box_holder").toggleClass("d-none"),t.closest(".comment_num_"+a).find("p.p-comment").html(i).toggleClass("d-none")):t.removeClass("disabled")})}),$(document).on("click",".show-hide-reply",function(e){e.preventDefault();var t=$(this),o=t.attr("data-id");if(0==uid)return window.location.assign(base_url+"Login?section=voicedetail&vid="+o),!1;var a=t.attr("data-comment_id"),i=$(document.createDocumentFragment()),l="";$.ajax({url:base_url+"YourVoice/get_comment_replies",method:"POST",data:{voice_id:o,comment_id:a,offset:0}}).done(function(e){e=JSON.parse(e),console.log(e);for(var n in e.data){var s=[];s.comment_reply_id=e.data[n].id,s.comment_id=e.data[n].comment_id,s.alias=e.data[n].alias,s.comment_reply=e.data[n].reply,s.user_id=e.data[n].user_id,s.voice_id=o,s.total_replies=e.data[n].total_replies,i.append(generatecommentbox(s,!0))}if(t.closest(".comment_container").find(".reply-container_"+a+" .comment-reply-list").html(i),"1"==e.is_available){l='<div class="row">                                            <div class="col-12 pt-1 text-right">                                                <a href="#" class="a-nostyle view-more-replies" data-id="'+o+'" data-comment_id="'+a+'" data-offset="5"><small>View more replies</small></a>                                            </div>                                        </div>',t.closest(".comment_container").find(".reply-container_"+a).append(l)}}),t.closest(".comment_container").find(".reply-container_"+a).toggleClass("d-none")}),$(document).on("click",".comment-delete",callback_delete_voice_comment),$("textarea.comment-reply-text").on("keyup",function(e){$(this).closest(".comment-reply-box-holder").find(".comment-reply-error").html("")}),$(document).on("click",".view-more-replies",view_more_replies),$(document).on("click",".post-comment-reply",function(e){if(e.preventDefault(),0==uid)return window.location.assign(base_url+"Login?section=voicedetail&vid="+voiceid),!1;var t=$(this),o=t.closest(".comment-reply-box-holder").find("textarea.comment-reply-text").val(),a=t.attr("data-comment_id"),i=t.attr("data-id");if(""==o)return t.closest(".comment-reply-box-holder").find(".comment-reply-error").html("Please enter reply."),!1;t.addClass("disabled");var l="";$.ajax({url:base_url+"YourVoice/reply_on_comment_voice",method:"POST",data:{voice_id:i,comment_id:a,comment_reply:o}}).done(function(e){if((e=JSON.parse(e)).status){var n=[];n.comment_reply_id=e.data.reply_id,n.comment_id=a,n.alias=$("body").attr("data-alias")?$("body").attr("data-alias"):"You",n.comment_reply=o,n.voice_id=i,n.user_id=uid,t.removeClass("disabled"),t.closest(".comment-reply-box-holder").find("textarea.comment-reply-text").val(""),l=generatecommentbox(n,!0),t.closest(".reply-container_"+a).find(".comment-reply-list").prepend(l)}else t.removeClass("disabled")})}),$(document).on("click",".post-edit-comment-reply",function(e){e.preventDefault();var t=$(this),o=t.attr("data-id"),a=t.attr("data-comment_id"),i=t.attr("data-reply_id"),l=t.closest(".edit_comment_reply_box_holder").find("textarea.edit-comment-reply-text").val().trim();if(""==l)return t.closest(".edit_comment_reply_box_holder").find(".edit-comment-reply-error").html("Please enter reply"),!1;t.addClass("disabled"),$.ajax({url:base_url+"YourVoice/update_comment_reply_on_voice",method:"POST",data:{voice_id:o,comment_id:a,comment_reply_id:i,comment_reply:l}}).done(function(e){(e=JSON.parse(e)).status?(t.removeClass("disabled"),t.closest(".reply_num_"+i).find(".edit_comment_reply_box_holder").toggleClass("d-none"),t.closest(".reply_num_"+i).find("p.maincolor").html(l).toggleClass("d-none")):t.removeClass("disabled")})}),$(document).on("click",".reply-delete",callback_delete_comment_reply),$(".voice-like").on("click",callback_voice_like),$(".view-more-comments").on("click",view_more_comments),$(document).on("click",".edit-comment-reply",function(e){e.preventDefault();var t=$(this).attr("data-reply_id");$(this).closest(".reply_num_"+t).find(".edit_comment_reply_box_holder").toggleClass("d-none").find("textarea").val($(this).closest(".reply_num_"+t).find("p.maincolor").text()),$(this).closest(".reply_num_"+t).find("p.maincolor").toggleClass("d-none")}),$("#cnfDeleteVoiceModal").on("show.bs.modal",function(e){var t=$(e.relatedTarget).attr("data-id");$("#cnfDeleteVoiceModal #del_voice_id").val(t)}),$("#cnfDeleteVoiceModal button#btn_delete_voice_yes").on("click",function(e){var t=$(this),o=$("#cnfDeleteVoiceModal #del_voice_id").val();t.attr("disabled","disabled").html("Processing..."),$.ajax({url:base_url+"YourVoice/delete_voice",method:"POST",data:{voice_id:o}}).done(function(e){setTimeout(function(){t.removeAttr("disabled").html("Yes"),window.location.assign(base_url+"YourVoice")},2e3)})})});var callback_voice_like=function(e){if(0==uid)return window.location.assign(base_url+"Login?section=voicedetail&vid="+voiceid),!1;e.preventDefault();var t=$(this),o=$(this).attr("data-is_user_liked"),a=$(this).attr("data-id");$.ajax({url:base_url+"YourVoice/like_unlike_voice",method:"POST",data:{voice_id:a,is_user_like:o}}).done(function(e){if((e=JSON.parse(e)).status){var a="0"==o?"1":"0";t.attr("data-is_user_liked",a),"0"==o?($(".voice-like").find("small").addClass("text-primary").removeClass("text-black-50"),$(".voice-like").find("svg").attr("fill","#007bff")):($(".voice-like").find("small").removeClass("text-primary").addClass("text-black-50"),$(".voice-like").find("svg").attr("fill","#7d7c8b")),$("#bloglikecomment .total-likes-count").html(e.data.total_likes)}})},callback_delete_voice_comment=function(e){e.preventDefault();var t=$(this),o=$(this).attr("data-id"),a=$(this).attr("data-comment_id"),i=parseInt($("#comentbox .total-comments-count").html());$.ajax({url:base_url+"YourVoice/delete_voice_comment",method:"POST",data:{voice_id:o,comment_id:a}}).done(function(e){(e=JSON.parse(e)).status&&(t.closest(".row.comment_num_"+a).slideUp("slow",function(){}),$("#comentbox .total-comments-count").html(i-1))})},callback_delete_comment_reply=function(e){e.preventDefault();var t=$(this),o=$(this).attr("data-id"),a=$(this).attr("data-comment_id"),i=$(this).attr("data-reply_id");$.ajax({url:base_url+"YourVoice/delete_voice_comment_reply",method:"POST",data:{voice_id:o,comment_id:a,comment_reply_id:i}}).done(function(e){(e=JSON.parse(e)).status&&t.closest(".row.reply_num_"+i).slideUp("slow",function(){})})},view_more_comments=function(e){if(e.preventDefault(),0==uid)return window.location.assign(base_url+"Login?section=voicedetail&vid="+voiceid),!1;var t=$(this),o=t.attr("data-id"),a=0==t.attr("data-offset")?2:t.attr("data-offset");$.ajax({url:base_url+"YourVoice/view_more_comments",method:"POST",data:{voice_id:o,offset:a}}).done(function(e){e=JSON.parse(e),console.log(e);var i=parseInt(e.data.length)+parseInt(a);console.log(i);var l=$(document.createDocumentFragment());for(var n in e.data){var s=[];s.comment_id=e.data[n].id,s.alias=e.data[n].alias,s.comment=e.data[n].comment,s.user_id=e.data[n].user_id,s.voice_id=o,s.total_replies=e.data[n].total_replies,l.append(generatecommentbox(s))}t.closest(".comment_container").find(".comments-list").append(l),t.attr("data-offset",i),"1"==e.is_available?t.closest(".row").show():t.closest(".row").hide()})},view_more_replies=function(e){if(0==uid)return window.location.assign(base_url+"Login?section=voicedetail&vid="+voiceid),!1;e.preventDefault();var t=$(this),o=t.attr("data-id"),a=t.attr("data-comment_id"),i=parseInt(t.attr("data-offset")),l=$(document.createDocumentFragment()),n="";$.ajax({url:base_url+"YourVoice/get_comment_replies",method:"POST",data:{voice_id:o,comment_id:a,offset:i}}).done(function(e){e=JSON.parse(e);for(var s in e.data){var c=[];c.comment_reply_id=e.data[s].id,c.comment_id=e.data[s].comment_id,c.alias=e.data[s].alias,c.comment_reply=e.data[s].reply,c.user_id=e.data[s].user_id,c.voice_id=o,l.append(generatecommentbox(c,!0))}if(t.closest(".comment_container").find(".reply-container_"+a+" .comment-reply-list").append(l),"1"==e.is_available){n='<div class="row">                                            <div class="col-12 pt-1 text-right">                                                <a href="#" class="a-nostyle view-more-replies" data-id="'+o+'" data-comment_id="'+a+'" data-offset="'+(i+5)+'"><small>View more replies</small></a>                                            </div>                                        </div>',t.closest(".comment_container").find(".reply-container_"+a).append(n),t.closest(".row").remove()}else t.closest(".comment_container").find(".reply-container_"+a+" .view-more-replies").closest(".row").hide()})},load_articles=function(e){$.ajax({url:base_url+"YourVoice/load_articles",method:"POST",data:{offset:e}}).done(function(e){var t=(e=JSON.parse(e)).data,o=$("<div />",{class:"row px-3"});if(t.length>0){for(var a in t){var i=getblock(t[a],!1);o.append(i)}$(".article-list").html(o)}else $(".article-list").html('<div class="row">                    <div class="col s11 m11 l11 offset-s1 offset-m1 offset-l1 text-center">                        <img src="'+base_url+'images/infographics/3.png" style="width: 50%;">                        <h5 class="fs16px fieldtitle ">No articles raised yet</h5>                    </div>                </div>')})},load_latest_voices=function(e){$.ajax({url:base_url+"YourVoice/load_latest_voices",method:"POST",data:{offset:e,voiceid:voiceid}}).done(function(e){var t="",o="";if((e=JSON.parse(e)).data.length>0){for(var a in e.data)o=create_slug(e.data[a].title),t+='<div class="col-md-4 blog-list-item">                                <a href="'+base_url+"YourVoice/blog_detail/"+e.data[a].id+"/"+o+"?t="+timestamp+'" class="d-block pb-3" style="">                                    <div class="voiceimg p-5" style="background: url('+base_url+"images/blogs/"+e.data[a].image+') no-repeat center center;"></div>                                    <small class="category">'+e.data[a].category+"</small>                                    <h6>"+e.data[a].title+'</h6>                                    <small class="likes">'+e.data[a].total_likes+" Likes &nbsp;&nbsp;●&nbsp;&nbsp; "+e.data[a].total_views+" Views</small>                                </a>                            </div>";$(".blog-list").html(t)}})};